"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.HtmlReportGenerator = void 0;
var fs_1 = require("fs");
var path_1 = require("path");
var HtmlReportGenerator = /** @class */ (function () {
    function HtmlReportGenerator() {
    }
    HtmlReportGenerator.addReport = function (report) {
        this.reports.push(report);
    };
    HtmlReportGenerator.generateHtmlReport = function (outputPath) {
        if (outputPath === void 0) { outputPath = './test-reports'; }
        // Ensure output directory exists
        if (!(0, fs_1.existsSync)(outputPath)) {
            (0, fs_1.mkdirSync)(outputPath, { recursive: true });
        }
        var htmlContent = this.generateHtmlContent();
        var filePath = (0, path_1.join)(outputPath, "test-report-".concat(new Date().toISOString().replace(/[:.]/g, '-'), ".html"));
        (0, fs_1.writeFileSync)(filePath, htmlContent, 'utf8');
        console.log("\uD83D\uDCCA HTML Report generated: ".concat(filePath));
    };
    HtmlReportGenerator.generateHtmlContent = function () {
        var _this = this;
        var totalTests = this.reports.length;
        var passedTests = this.reports.filter(function (r) { return r.status === 'PASSED'; }).length;
        var failedTests = totalTests - passedTests;
        return "\n<!DOCTYPE html>\n<html lang=\"de\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Playwright Test Report</title>\n    <script src=\"https://cdn.tailwindcss.com\"></script>\n    <script>\n        tailwind.config = {\n            theme: {\n                extend: {\n                    colors: {\n                        'success': '#10b981',\n                        'error': '#ef4444',\n                        'warning': '#f59e0b'\n                    }\n                }\n            }\n        }\n    </script>\n    <style>\n        .collapsible-content {\n            max-height: 0;\n            overflow: hidden;\n            transition: max-height 0.3s ease-out;\n        }\n        .collapsible-content.expanded {\n            max-height: 2000px;\n            transition: max-height 0.5s ease-in;\n        }\n    </style>\n</head>\n<body class=\"bg-gray-50 min-h-screen\">\n    <div class=\"container mx-auto px-4 py-8\">\n        <!-- Header -->\n        <div class=\"bg-white rounded-lg shadow-lg p-6 mb-8\">\n            <div class=\"flex items-center justify-between mb-4\">\n                <h1 class=\"text-3xl font-bold text-gray-800\">\uD83C\uDFAD Playwright Test Report</h1>\n                <div class=\"text-sm text-gray-500\">\n                    Generated: ".concat(new Date().toLocaleString('de-DE'), "\n                </div>\n            </div>\n            \n            <!-- Summary Cards -->\n            <div class=\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6\">\n                <div class=\"bg-blue-50 p-4 rounded-lg border border-blue-200\">\n                    <div class=\"flex items-center\">\n                        <div class=\"text-2xl mr-3\">\uD83D\uDCCA</div>\n                        <div>\n                            <div class=\"text-2xl font-bold text-blue-600\">").concat(totalTests, "</div>\n                            <div class=\"text-sm text-gray-600\">Total Tests</div>\n                        </div>\n                    </div>\n                </div>\n                \n                <div class=\"bg-green-50 p-4 rounded-lg border border-green-200\">\n                    <div class=\"flex items-center\">\n                        <div class=\"text-2xl mr-3\">\u2705</div>\n                        <div>\n                            <div class=\"text-2xl font-bold text-green-600\">").concat(passedTests, "</div>\n                            <div class=\"text-sm text-gray-600\">Passed</div>\n                        </div>\n                    </div>\n                </div>\n                \n                <div class=\"bg-red-50 p-4 rounded-lg border border-red-200\">\n                    <div class=\"flex items-center\">\n                        <div class=\"text-2xl mr-3\">\u274C</div>\n                        <div>\n                            <div class=\"text-2xl font-bold text-red-600\">").concat(failedTests, "</div>\n                            <div class=\"text-sm text-gray-600\">Failed</div>\n                        </div>\n                    </div>\n                </div>\n                \n                <div class=\"bg-purple-50 p-4 rounded-lg border border-purple-200\">\n                    <div class=\"flex items-center\">\n                        <div class=\"text-2xl mr-3\">\u26A1</div>\n                        <div>\n                            <div class=\"text-2xl font-bold text-purple-600\">").concat(Math.round((passedTests / totalTests * 100) || 0), "%</div>\n                            <div class=\"text-sm text-gray-600\">Success Rate</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Test Results -->\n        <div class=\"space-y-4\">\n            ").concat(this.reports.map(function (report, index) { return _this.generateTestReportCard(report, index); }).join(''), "\n        </div>\n    </div>\n\n    <script>\n        function toggleCollapse(id) {\n            const content = document.getElementById('content-' + id);\n            const icon = document.getElementById('icon-' + id);\n            \n            if (content.classList.contains('expanded')) {\n                content.classList.remove('expanded');\n                icon.style.transform = 'rotate(0deg)';\n            } else {\n                content.classList.add('expanded');\n                icon.style.transform = 'rotate(90deg)';\n            }\n        }\n        \n        // Auto-expand failed tests\n        document.addEventListener('DOMContentLoaded', function() {\n            const failedTests = document.querySelectorAll('[data-status=\"FAILED\"]');\n            failedTests.forEach(test => {\n                const id = test.getAttribute('data-test-id');\n                toggleCollapse(id);\n            });\n        });\n    </script>\n</body>\n</html>");
    };
    HtmlReportGenerator.generateTestReportCard = function (report, index) {
        var _this = this;
        var statusIcon = report.status === 'PASSED' ? '✅' : '❌';
        var statusClass = report.status === 'PASSED' ? 'border-green-200 bg-green-50' : 'border-red-200 bg-red-50';
        var headerClass = report.status === 'PASSED' ? 'bg-green-100' : 'bg-red-100';
        return "\n        <!-- Test Card ".concat(index + 1, " -->\n        <div class=\"bg-white rounded-lg shadow-lg border-2 ").concat(statusClass, "\" data-status=\"").concat(report.status, "\" data-test-id=\"").concat(index, "\">\n            <!-- Test Header (Clickable) -->\n            <div class=\"p-4 cursor-pointer hover:bg-gray-50 transition-colors ").concat(headerClass, "\" onclick=\"toggleCollapse(").concat(index, ")\">\n                <div class=\"flex items-center justify-between\">\n                    <div class=\"flex items-center space-x-3\">\n                        <div class=\"text-2xl\">").concat(statusIcon, "</div>\n                        <div>\n                            <h3 class=\"text-lg font-semibold text-gray-800\">").concat(report.testName, "</h3>\n                            <div class=\"text-sm text-gray-600\">\n                                <span class=\"inline-flex items-center mr-4\">\n                                    <span class=\"w-2 h-2 bg-blue-400 rounded-full mr-1\"></span>\n                                    ").concat(report.testSpec, "\n                                </span>\n                                <span class=\"inline-flex items-center mr-4\">\n                                    <span class=\"w-2 h-2 bg-purple-400 rounded-full mr-1\"></span>\n                                    ").concat(report.environment, "\n                                </span>\n                                <span class=\"inline-flex items-center\">\n                                    <span class=\"w-2 h-2 bg-gray-400 rounded-full mr-1\"></span>\n                                    ").concat(report.totalSteps, " Steps\n                                </span>\n                            </div>\n                        </div>\n                    </div>\n                    \n                    <div class=\"flex items-center space-x-4\">\n                        <!-- Step Statistics -->\n                        <div class=\"text-right text-sm\">\n                            <div class=\"text-green-600 font-semibold\">\u2705 ").concat(report.passedSteps, "</div>\n                            <div class=\"text-red-600 font-semibold\">\u274C ").concat(report.failedSteps, "</div>\n                        </div>\n                        \n                        <!-- Collapse Icon -->\n                        <div id=\"icon-").concat(index, "\" class=\"text-gray-400 transition-transform duration-200\">\n                            \u25B6\n                        </div>\n                    </div>\n                </div>\n            </div>\n            \n            <!-- Collapsible Content -->\n            <div id=\"content-").concat(index, "\" class=\"collapsible-content\">\n                <div class=\"px-4 pb-4\">\n                    <!-- Test Timeline -->\n                    <div class=\"bg-gray-50 rounded-lg p-3 mb-4\">\n                        <div class=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm\">\n                            <div>\n                                <span class=\"font-semibold text-gray-600\">Start:</span>\n                                <span class=\"text-gray-800\">").concat(report.startTime, "</span>\n                            </div>\n                            <div>\n                                <span class=\"font-semibold text-gray-600\">End:</span>\n                                <span class=\"text-gray-800\">").concat(report.endTime, "</span>\n                            </div>\n                        </div>\n                    </div>\n                    \n                    <!-- Steps -->\n                    <div class=\"space-y-2\">\n                        <h4 class=\"font-semibold text-gray-700 mb-3\">\uD83D\uDCCB Test Steps</h4>\n                        ").concat(report.steps.map(function (step) { return _this.generateStepCard(step); }).join(''), "\n                    </div>\n                </div>\n            </div>\n        </div>");
    };
    HtmlReportGenerator.generateStepCard = function (step) {
        var statusIcon = step.status === 'PASSED' ? '✅' : '❌';
        var statusClass = step.status === 'PASSED' ? 'border-l-green-400 bg-green-50' : 'border-l-red-400 bg-red-50';
        return "\n        <div class=\"border-l-4 ".concat(statusClass, " p-3 rounded-r-lg\">\n            <div class=\"flex items-start justify-between\">\n                <div class=\"flex items-start space-x-3\">\n                    <div class=\"text-lg\">").concat(statusIcon, "</div>\n                    <div class=\"flex-1 min-w-0\">\n                        <div class=\"flex items-center space-x-2 mb-1\">\n                            <span class=\"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800\">\n                                Step ").concat(step.stepNumber, "\n                            </span>\n                            <span class=\"text-sm text-gray-500\">").concat(step.timestamp, "</span>\n                        </div>\n                        \n                        <div class=\"text-sm\">\n                            <span class=\"font-semibold text-gray-700\">").concat(step.fileName, "</span>\n                            <span class=\"text-gray-500\"> \u2192 </span>\n                            <span class=\"font-medium text-gray-600\">").concat(step.methodName, "</span>\n                        </div>\n                        \n                        ").concat(step.details ? "<div class=\"text-sm text-gray-600 mt-1\">".concat(step.details, "</div>") : '', "\n                        ").concat(step.locator ? "<div class=\"text-xs text-gray-500 mt-1 font-mono bg-gray-100 p-1 rounded\">Locator: ".concat(step.locator, "</div>") : '', "\n                        ").concat(step.url ? "<div class=\"text-xs text-blue-600 mt-1\">\uD83C\uDF10 ".concat(step.url, "</div>") : '', "\n                        ").concat(step.responseStatus ? "<div class=\"text-xs text-orange-600 mt-1\">Status: ".concat(step.responseStatus, "</div>") : '', "\n                    </div>\n                </div>\n            </div>\n        </div>");
    };
    HtmlReportGenerator.clearReports = function () {
        this.reports = [];
    };
    HtmlReportGenerator.reports = [];
    return HtmlReportGenerator;
}());
exports.HtmlReportGenerator = HtmlReportGenerator;
